---
import AppLayout from "@/layouts/AppLayout.astro";
import { TaskList } from "@/components/task-list/TaskList";
import { getServerSessionWithProfile } from "@/lib/services/user.service";

const supabase = Astro.locals.supabase;
const { session, userProfile } = await getServerSessionWithProfile(supabase);

if (!session) {
  return Astro.redirect("/login");
}

const token = session.access_token;

export const prerender = false;
---

<AppLayout title="Wszystkie zadania - Chronos" userProfile={userProfile}>
  <TaskList client:load token={token} />
</AppLayout>
