---
description: 
globs: 
alwaysApply: false
---

## Github Action Rules

- Check if `package.json` exists in project root and summarize key scripts
- Check if `.nvmrc` exists in project root
- Check if `.env.example` exists in project root to identify key `env:` variables
- Always use `git branch -a` to verify whether we use `main` or `master` branch
- Always use `env:` variables and secrets attached to jobs instead of global workflows
- Always use `npm ci` for Node-based dependency setup
- Extract common steps into composite actions in separate files when patterns repeat
- Always verify action versions are up-to-date before finalizing workflows
- Once you're done, as a final step conduct the following: 

### 1) Verify Latest Action Versions

For each public action, check the latest version (use only major version):

**Unix/Linux/macOS (bash):**
```bash
curl -s https://api.github.com/repos/{owner}/{repo}/releases/latest | grep '"tag_name":' | sed -E 's/.*"v([0-9]+).*/\1/'
```

**Windows (PowerShell):**
```powershell
Invoke-WebRequest -Uri "https://api.github.com/repos/{owner}/{repo}/releases/latest" | Select-Object -ExpandProperty Content | ConvertFrom-Json | Select-Object -ExpandProperty tag_name
```

### 2) Verify Action Documentation (Optional)

Fetch README.md to check for deprecated features:

**Unix/Linux/macOS (bash):**
```bash
curl -s https://raw.githubusercontent.com/{owner}/{repo}/refs/tags/v{TAG_VERSION}/README.md
```

**Windows (PowerShell):**
```powershell
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/{owner}/{repo}/refs/tags/v{TAG_VERSION}/README.md" | Select-Object -ExpandProperty Content
```

Or for main/master branch:

**Windows (PowerShell):**
```powershell
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/{owner}/{repo}/refs/heads/{main/master}/README.md" | Select-Object -ExpandProperty Content
```

### 3) Check if Action is Archived (Optional)

Verify the action is not deprecated/archived:

**Unix/Linux/macOS (bash):**
```bash
curl -s https://api.github.com/repos/{owner}/{repo} | grep '"archived":'
```

**Windows (PowerShell):**
```powershell
Invoke-WebRequest -Uri "https://api.github.com/repos/{owner}/{repo}" | Select-Object -ExpandProperty Content | ConvertFrom-Json | Select-Object -ExpandProperty archived
```

### 4) Fetch Action Definition (Optional)

In case of linter issues related to action parameters:

**Unix/Linux/macOS (bash):**
```bash
curl -s https://raw.githubusercontent.com/{owner}/{repo}/refs/heads/{main/master}/action.yml
```

**Windows (PowerShell):**
```powershell
Invoke-WebRequest -Uri "https://raw.githubusercontent.com/{owner}/{repo}/refs/heads/{main/master}/action.yml" | Select-Object -ExpandProperty Content
```

## Cloudflare Pages Deployment

When deploying to Cloudflare Pages:
- Use `cloudflare/wrangler-action@v3` (verify latest version)
- Always include `apiToken`, `accountId`, and `command` parameters
- For GitHub Deployments integration, add `gitHubToken: ${{ secrets.GITHUB_TOKEN }}`
- Add appropriate permissions: `contents: read` and `deployments: write`
- Use output variables like `deployment-url` and `pages-deployment-alias-url` for deployment tracking
- Ensure Cloudflare KV namespace for sessions is configured if using `@astrojs/cloudflare` adapter